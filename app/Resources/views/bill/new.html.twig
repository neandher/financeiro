{% extends 'base.html.twig' %}

{% block title %}{{ parent() ~ ' - ' ~ 'bill.title.new'|trans }}{% endblock %}
{% block page_title %}{{ 'bill.title.menu'|trans }}{% endblock %}

{% block body %}

    <div class="portlet light bordered">

        <div class="portlet-title">

            <div class="caption">
                <i class="icon-plus font-green-sharp"></i>
                <span class="caption-subject font-green-sharp bold uppercase">{{ 'bill.title.new'|trans }}</span>
            </div>

            <div class="actions">
                <a href="{{ path('bill_index') ~ pagination_helper.buildQuery }}" class="btn default">
                    <span class="fa fa-arrow-circle-left"></span> {{ 'form.link.go_back'|trans }}
                </a>
            </div>

        </div>

        <div class="portlet-body form">

            {{ form_start(form, {'action': path('bill_new') ~ pagination_helper.buildQuery, 'attr' : {'class' : 'horizontal-form', 'novalidate': 'novalidate'}}) }}

            {{ form_errors(form) }}

            {{ include('partials/alerts.html.twig') }}

            <div class="form-body">

                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active">
                        <a href="#dados" aria-controls="dados" role="tab" data-toggle="tab">Dados</a>
                    </li>
                    <li role="presentation">
                        <a href="#parcelas" aria-controls="parcelas" role="tab" data-toggle="tab">Parcelas</a>
                    </li>
                </ul>

                <br>

                <div class="tab-content">

                    <div role="tabpanel" class="tab-pane active" id="dados">
                        <div class="row">
                            {{ form_row(form.billCategory, {'attr': {'autofocus': true}}) }}
                            {{ form_row(form.description) }}
                            {{ form_row(form.billPlan) }}
                            {{ form_row(form.choices.bank) }}
                            {{ form_row(form.note) }}
                        </div>
                    </div>

                    <div role="tabpanel" class="tab-pane" id="parcelas">

                        <div class="row">
                            <div class="col-md-12">
                                <a href="#" class="btn btn-default pull-right" data-toggle="modal"
                                   data-target="#generateInstallment">Gerar Parcelas</a>
                            </div>
                        </div>

                        <br>

                        <div id="installments"
                             data-prototype="{{ form_widget(form.billInstallments.vars.prototype)|e('html_attr') }}">
                            {% if form.vars.submitted and form.vars.valid == false %}
                                {% for billInstallment in form.billInstallments %}
                                    <div class="panel panel-default">
                                        <div class="panel-body">
                                            {{ form_widget(billInstallment) }}
                                        </div>
                                    </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>

                </div>

            </div>

        </div>

        <div class="form-actions">
            {{ form_widget(form.buttons.save_and_keep, {'attr' : {'class' : 'green'}}) }}
            {{ form_widget(form.buttons.save_and_new, {'attr' : {'class' : 'green'}}) }}
            {{ form_widget(form.buttons.save_and_close, {'attr' : {'class' : 'green'}}) }}
        </div>

        {{ form_end(form) }}

        {{ include('bill/installment_modal.html.twig') }}

    </div>

{% endblock %}

{% block javascripts %}

    <script>
        jQuery(document).ready(function () {
            installmentsInit();
        });
    </script>

{% endblock %}