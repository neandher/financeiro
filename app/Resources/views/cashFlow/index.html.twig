{% extends 'base.html.twig' %}

{% block body %}

    <div class="table-responsive">
        <table class="table table-striped table-bordered cash-flow-table">

            <thead>
            <tr>
                <th>&nbsp;</th>
                {% for i in 1..12 %}
                    <th class="text-center
                    {% if i == "now"|date('n') %}bg-green bg-font-green{% else %}bg-green bg-font-green{% endif %}"
                    >
                        {{ i |date("now"|date('Y') ~ '-' ~ i ~ '-' ~ "now"|date('d')) |date('M') }}
                    </th>
                {% endfor %}
            </tr>
            </thead>

            <tbody>
            <tr>
                <th class="bg-blue-dark bg-font-blue-dark"> Saldo Final</th>
                {% for i in 1..12 %}

                    {% set paid_option = paidOption(i,params.year) %}

                    {% if paid_option == 'PAID_AND_NOT_PAID' %}
                        <th class="text-center bg-green bg-font-green">
                            <span class="{{ billCategoryStyle(cash_flow_data['saldo_final'][i]) }}">
                                {{ cash_flow_data['saldo_final'][i]|number_format(2,',','.') }}
                            </span>
                            <hr>
                            <span class="{{ billCategoryStyle(cash_flow_data['previsao_saldo_final'][i]) }}">
                                {{ cash_flow_data['previsao_saldo_final'][i]|number_format(2,',','.') }}
                            </span>
                        </th>
                    {% else %}
                        <th class="{{ billCategoryStyle(cash_flow_data['previsao_saldo_final'][i]) }} bg-blue-dark bg-font-blue-dark">
                            {{ cash_flow_data['previsao_saldo_final'][i]|number_format(2,',','.') }}
                        </th>
                    {% endif %}

                {% endfor %}
            </tr>
            </tbody>

            <tbody>
            <tr>
                <th scope="row" style="background-color: #fff !important; font-weight: normal">
                     Saldo M&ecirc;s Anterior
                </th>
                {% for i in 1..12 %}
                    {% if i == "now"|date('n') %}
                        <th class="text-center bg-green bg-font-green {{ billCategoryStyle(cash_flow_data['saldo_anterior'][i]) }}">
                            {{ cash_flow_data['saldo_anterior'][i]|number_format(2,',','.') }}
                        </th>
                    {% else %}
                        <td class="{{ billCategoryStyle(cash_flow_data['saldo_anterior'][i]) }}">
                            {{ cash_flow_data['saldo_anterior'][i]|number_format(2,',','.') }}
                        </td>
                    {% endif %}
                {% endfor %}
            </tr>
            </tbody>

            <tbody>
            <tr>
                <th style="background-color: #fff !important; font-weight: normal">
                     Gera&ccedil;&atilde;o de Caixa
                </th>
                {% for i in 1..12 %}

                    {% set paid_option = paidOption(i,params.year) %}

                    {% if paid_option == 'PAID_AND_NOT_PAID' %}
                        <th class="text-center bg-green bg-font-green">
                            <span class="{{ billCategoryStyle(cash_flow_data['total_paid'][i]) }}">
                                {{ cash_flow_data['total_paid'][i]|number_format(2,',','.') }}
                            </span>
                            <hr>
                            <span class="{{ billCategoryStyle(cash_flow_data['total_not_paid'][i]) }}">
                                {{ cash_flow_data['total_not_paid'][i]|number_format(2,',','.') }}
                            </span>
                        </th>
                    {% elseif paid_option == 'NOT_PAID' %}
                        <td class="{{ billCategoryStyle(cash_flow_data['total_not_paid'][i]) }}">
                            {{ cash_flow_data['total_not_paid'][i]|number_format(2,',','.') }}
                        </td>
                    {% elseif paid_option == 'PAID' %}
                        <td class="{{ billCategoryStyle(cash_flow_data['total_paid'][i]) }}">
                            {{ cash_flow_data['total_paid'][i]|number_format(2,',','.') }}
                        </td>
                    {% endif %}
                {% endfor %}
            </tr>
            </tbody>

            {% for bill_category in cash_flow_data['content'] %}

                <tbody>
                <tr>
                    <th class="bg-blue-dark bg-font-blue-dark"> {{ bill_category[0]['description'] }}</th>

                    {% for i in 1..12 %}

                        {% set paid_option = paidOption(i,params.year) %}

                        {% if paid_option == 'PAID_AND_NOT_PAID' %}

                            <th class="text-center bg-green bg-font-green">
                                <span class="{{ billCategoryStyle(bill_category['total_bill_category_paid'][i]) }}">
                                    {{ bill_category['total_bill_category_paid'][i]|number_format(2,',','.') }}
                                </span>
                                <hr>
                                <span class="{{ billCategoryStyle(bill_category['total_bill_category_not_paid'][i]) }}">
                                    {{ bill_category['total_bill_category_not_paid'][i]|number_format(2,',','.') }}
                                </span>
                            </th>

                        {% elseif paid_option == 'NOT_PAID' %}
                            <th class="{{ billCategoryStyle(bill_category['total_bill_category_not_paid'][i]) }} bg-blue-dark bg-font-blue-dark">
                                {{ bill_category['total_bill_category_not_paid'][i]|number_format(2,',','.') }}
                            </th>
                        {% elseif paid_option == 'PAID' %}
                            <th class="{{ billCategoryStyle(bill_category['total_bill_category_paid'][i]) }} bg-blue-dark bg-font-blue-dark">
                                {{ bill_category['total_bill_category_paid'][i]|number_format(2,',','.') }}
                            </th>
                        {% endif %}

                    {% endfor %}
                </tr>
                </tbody>


                {% for bill_plan_category in bill_category['bill_plan_categories'] %}

                    <tbody>
                    <tr>
                        <th class="bg-default bg-font-default">
                            
                            {{ bill_plan_category[0]['description'] }}
                        </th>

                        {% for i in 1..12 %}

                            {% set paid_option = paidOption(i,params.year) %}

                            {% if paid_option == 'PAID_AND_NOT_PAID' %}

                                <th class="text-center bg-green bg-font-green">
                                    <span class="{{ billCategoryStyle(bill_plan_category[i]['total_paid']) }}">
                                        {{ bill_plan_category[i]['total_paid']|number_format(2,',','.') }}
                                    </span>
                                    <hr>
                                    <span class="{{ billCategoryStyle(bill_plan_category[i]['total_not_paid']) }}">
                                        {{ bill_plan_category[i]['total_not_paid']|number_format(2,',','.') }}
                                     </span>
                                </th>

                            {% elseif paid_option == 'NOT_PAID' %}
                                <th class="{{ billCategoryStyle(bill_plan_category[i]['total_not_paid']) }} bg-default bg-font-default">
                                    {{ bill_plan_category[i]['total_not_paid']|number_format(2,',','.') }}
                                </th>
                            {% elseif paid_option == 'PAID' %}
                                <th class="{{ billCategoryStyle(bill_plan_category[i]['total_paid']) }} bg-default bg-font-default">
                                    {{ bill_plan_category[i]['total_paid']|number_format(2,',','.') }}
                                </th>
                            {% endif %}

                        {% endfor %}
                    </tr>
                    </tbody>

                    {% for bill_plan_key,bill_plan in bill_plan_category['bill_plans'] %}

                        <tbody>
                        <tr>
                            <th style="background-color: #fff !important; font-weight: normal">
                                {{ bill_plan[0]['description'] }}
                            </th>

                            {% for i in 1..12 %}

                                {% set paid_option = paidOption(i,params.year) %}

                                {% if paid_option == 'PAID_AND_NOT_PAID' %}

                                    <th class="text-center bg-green bg-font-green">
                                        <span class="{{ billCategoryStyle(bill_plan[i]['total_paid']) }}">
                                            {{ bill_plan[i]['total_paid']|number_format(2,',','.') }}
                                        </span>
                                        <hr>
                                        <span class="{{ billCategoryStyle(bill_plan[i]['total_not_paid']) }}">
                                            {{ bill_plan[i]['total_not_paid']|number_format(2,',','.') }}
                                        </span>
                                    </th>

                                {% elseif paid_option == 'NOT_PAID' %}
                                    <td class="{{ billCategoryStyle(bill_plan[i]['total_not_paid']) }}">
                                        {{ bill_plan[i]['total_not_paid']|number_format(2,',','.') }}
                                    </td>
                                {% elseif paid_option == 'PAID' %}
                                    <td class="{{ billCategoryStyle(bill_plan[i]['total_paid']) }}">
                                        {{ bill_plan[i]['total_paid']|number_format(2,',','.') }}
                                    </td>
                                {% endif %}

                            {% endfor %}
                        </tr>
                        </tbody>

                    {% endfor %}

                {% endfor %}

            {% endfor %}

        </table>
    </div>

{% endblock %}